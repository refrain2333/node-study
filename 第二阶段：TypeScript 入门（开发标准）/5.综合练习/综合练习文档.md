## ç¬¬äºŒé˜¶æ®µç»¼åˆç»ƒä¹  - å®Œæ•´é¡¹ç›®è§£æ

### ğŸ“š ç»ƒä¹ ç›®æ ‡

é€šè¿‡ 6 ä¸ªçœŸå®é¡¹ç›®æ•´åˆç¬¬äºŒé˜¶æ®µå­¦ä¹ çš„æ‰€æœ‰çŸ¥è¯†ç‚¹ï¼š
- æ¥å£ä¸ç±»å‹åˆ«åå®æˆ˜
- æ³›å‹åœ¨ä¸šåŠ¡é€»è¾‘ä¸­çš„åº”ç”¨
- ç±»å’Œç»§æ‰¿çš„è®¾è®¡æ¨¡å¼
- å¼‚æ­¥ç¼–ç¨‹çš„ç±»å‹å®‰å…¨
- é«˜é˜¶å‡½æ•°å’Œå‡½æ•°å¼ç¼–ç¨‹

---

### ğŸ¯ é¡¹ç›®1ï¼šç”¨æˆ·ç®¡ç†ç³»ç»Ÿ

#### æ ¸å¿ƒçŸ¥è¯†ç‚¹
- **æ¥å£è®¾è®¡** - æ¸…æ™°çš„æ•°æ®å¥‘çº¦
- **æšä¸¾ç±»å‹** - å—é™çš„å­—ç¬¦ä¸²å€¼
- **éƒ¨åˆ†ç±»å‹** (`Partial<T>`) - å¯é€‰æ›´æ–°

#### å…³é”®ä»£ç è§£æ

```typescript
// å®šä¹‰æ¸…æ™°çš„ç±»å‹è¾¹ç•Œ
interface UserProfile {
  id: number;
  name: string;
  email: string;
  age?: number;        // å¯é€‰å±æ€§
  isActive: boolean;
  roles: Role[];       // è§’è‰²æ•°ç»„
}

// å­—é¢é‡ç±»å‹ - é™åˆ¶å€¼èŒƒå›´
type Role = "admin" | "user" | "guest";
```

#### è®¾è®¡æ¨¡å¼
- **ä»“å‚¨æ¨¡å¼** - åˆ†ç¦»æ•°æ®è®¿é—®é€»è¾‘
- **æœåŠ¡å±‚** - ä¸šåŠ¡é€»è¾‘å’ŒéªŒè¯
- **å“åº”åŒ…è£…** - ç»Ÿä¸€çš„ API è¿”å›æ ¼å¼

#### åº”ç”¨åœºæ™¯
```
ç”¨æˆ·ç®¡ç†ç³»ç»Ÿ â†’ ç¬¬ä¸‰é˜¶æ®µ Koa é¡¹ç›®çš„æ ¸å¿ƒæ¨¡å—
```

---

### ğŸ›’ é¡¹ç›®2ï¼šè´­ç‰©è½¦ç³»ç»Ÿ

#### æ ¸å¿ƒçŸ¥è¯†ç‚¹
- **æ³›å‹çº¦æŸ** - `<T extends Product>`
- **æ³›å‹ç±»** - ç±»å‹å®‰å…¨çš„å®¹å™¨
- **å¤åˆç±»å‹** - CartItem åŒ…å« Product

#### æ³›å‹çº¦æŸè¯¦è§£

```typescript
// åªæ¥å—ç¬¦åˆ Product æ¥å£çš„ç±»å‹
class Cart<T extends Product> {
  addItem(product: T, quantity: number): void {
    // T å¿…é¡»æœ‰ id å’Œ price å±æ€§
    // ç¼–è¯‘å™¨èƒ½å¤ŸéªŒè¯ï¼
  }
}
```

#### è®¾è®¡ç‰¹ç‚¹
- âœ… ç±»å‹å®‰å…¨ - ç¼–è¯‘æ—¶æ£€æŸ¥äº§å“å±æ€§
- âœ… å¯å¤ç”¨ - æ”¯æŒä»»ä½•äº§å“ç±»å‹
- âœ… çµæ´» - æ‰©å±•äº§å“å±æ€§æ— éœ€æ”¹ä»£ç 

---

### â±ï¸ é¡¹ç›®3ï¼šå¼‚æ­¥æ•°æ®å¤„ç†

#### æ ¸å¿ƒçŸ¥è¯†ç‚¹
- **Promise æ³›å‹** - `Promise<T>`
- **å¼‚æ­¥/ç­‰å¾…** - å¼‚æ­¥æµç¨‹æ§åˆ¶
- **é”™è¯¯å¤„ç†** - try-catch çš„ç±»å‹å®‰å…¨

#### FetchResult åŒ…è£…

```typescript
interface FetchResult<T> {
  success: boolean;
  data?: T;      // æˆåŠŸæ—¶å­˜åœ¨
  error?: string; // å¤±è´¥æ—¶å­˜åœ¨
}

// è°ƒç”¨æ–¹ä»£ç 
const result = await fetchUserData(1);
if (result.success && result.data) {
  // TypeScript çŸ¥é“ data ä¸€å®šå­˜åœ¨ï¼
  const user = result.data;
}
```

#### å¹¶å‘å¤„ç†

```typescript
// åŒæ—¶è·å–å¤šä¸ªç”¨æˆ·
const results = await Promise.all(
  userIds.map(id => fetchUserData(id))
);

// ç±»å‹å®‰å…¨çš„è¿‡æ»¤
const users = results
  .filter(result => result.success && result.data)
  .map(result => result.data!);
```

---

### ğŸ”„ é¡¹ç›®4ï¼šæ•°æ®è½¬æ¢ç®¡é“

#### æ ¸å¿ƒçŸ¥è¯†ç‚¹
- **å‡½æ•°ç±»å‹** - `Transformer<T, U>`
- **æ³›å‹å‡½æ•°** - é€šç”¨è½¬æ¢å™¨
- **é“¾å¼è°ƒç”¨** - Pipeline æ¨¡å¼

#### é«˜é˜¶å‡½æ•°è®¾è®¡

```typescript
// è½¬æ¢å‡½æ•°çš„ç±»å‹ç­¾å
type Transformer<T, U> = (data: T) => U;

const toUpperCase: Transformer<string, string> = (str) => 
  str.toUpperCase();

const addPrefix: Transformer<string, string> = (str) => 
  `PREFIX_${str}`;
```

#### Pipeline çš„åŠ›é‡

```typescript
// é“¾å¼æ“ä½œ - æ¯ä¸ª pipe éƒ½æ˜¯ç±»å‹å®‰å…¨çš„ï¼
const result = new Pipeline("hello")
  .pipe(toUpperCase)           // string â†’ string âœ“
  .pipe(addPrefix)             // string â†’ string âœ“
  .pipe(addSuffix)             // string â†’ string âœ“
  .get();
```

#### vs JavaScript

```javascript
// ä¼ ç»Ÿ JavaScript å†™æ³•
let result = "hello";
result = toUpperCase(result);
result = addPrefix(result);
result = addSuffix(result);

// TypeScript Pipeline å†™æ³•
const result = new Pipeline("hello")
  .pipe(toUpperCase)
  .pipe(addPrefix)
  .pipe(addSuffix)
  .get();

// ä¼˜åŠ¿ï¼š
// 1. æ›´æ¸…æ™°çš„è½¬æ¢æµç¨‹
// 2. ç±»å‹æ£€æŸ¥æ¯ä¸€æ­¥
// 3. æ˜“äºé“¾å¼æ‰©å±•
```

---

### ğŸ“¢ é¡¹ç›®5ï¼šäº‹ä»¶ç³»ç»Ÿ

#### æ ¸å¿ƒçŸ¥è¯†ç‚¹
- **æ³›å‹äº‹ä»¶** - `EventEmitter<T>`
- **å‘å¸ƒ/è®¢é˜…** - è§£è€¦è®¾è®¡
- **å‡½æ•°å›è°ƒ** - äº‹ä»¶å¤„ç†å™¨

#### å®ç°ç»†èŠ‚

```typescript
// äº‹ä»¶å¤„ç†å™¨çš„ç±»å‹
interface EventHandler<T> {
  (data: T): void;
}

class EventEmitter<T> {
  private handlers: Set<EventHandler<T>> = new Set();

  on(handler: EventHandler<T>): void {
    this.handlers.add(handler);
  }

  emit(data: T): void {
    this.handlers.forEach(handler => handler(data));
  }
}
```

#### ç±»å‹å®‰å…¨ç¤ºä¾‹

```typescript
// å®šä¹‰äº‹ä»¶ç±»å‹
interface UserCreatedEvent {
  userId: number;
  userName: string;
  timestamp: Date;
}

const emitter = new EventEmitter<UserCreatedEvent>();

// æ³¨å†Œäº‹ä»¶ - è‡ªåŠ¨å®Œæˆæç¤ºï¼
emitter.on((event) => {
  // event è‡ªåŠ¨æ¨æ–­ä¸º UserCreatedEvent
  console.log(event.userName); // âœ“ ç±»å‹æ£€æŸ¥é€šè¿‡
  console.log(event.xyz);      // âœ— ç±»å‹é”™è¯¯ï¼
});
```

#### vs JavaScript

```javascript
// JSï¼šè¿è¡Œæ—¶æ‰å‘ç°é”™è¯¯
emitter.on((event) => {
  console.log(event.xyz); // æ²¡æœ‰æç¤ºï¼Œè¿è¡Œæ—¶é”™è¯¯
});

// TSï¼šç¼–è¯‘æ—¶å°±å‘ç°é”™è¯¯
emitter.on((event) => {
  console.log(event.xyz); // ç¼–è¯‘å™¨ï¼šå±æ€§ 'xyz' ä¸å­˜åœ¨ï¼
});
```

---

### ğŸ”Œ é¡¹ç›®6ï¼šAPI å±‚ç±»å‹å®šä¹‰

#### æ ¸å¿ƒçŸ¥è¯†ç‚¹
- **è”åˆç±»å‹** - å¤šç§å¯èƒ½çš„å“åº”
- **æ³›å‹ API** - å¯å¤ç”¨çš„è¯·æ±‚/å“åº”
- **ç±»å‹å®ˆå«** - åŒºåˆ†ä¸åŒå“åº”

#### API å“åº”è®¾è®¡

```typescript
// æ–¹æ¡ˆ1ï¼šåˆ†ç¦»æˆåŠŸå’Œå¤±è´¥
interface ApiResponseSuccess<T> {
  code: 200;
  message: string;
  data: T;
}

interface ApiResponseError {
  code: number;
  message: string;
}

// æ–¹æ¡ˆ2ï¼šè”åˆç±»å‹
type ApiResponseData<T> = ApiResponseSuccess<T> | ApiResponseError;

// ä½¿ç”¨æ–¹ï¼šæ¸…æ™°çš„ç±»å‹å®ˆå«
async function handleApiCall<T>() {
  const response = await apiCall<any, T>(...);

  if (response.code === 200) {
    // ç¼–è¯‘å™¨çŸ¥é“ï¼šresponse.data å­˜åœ¨ï¼
    const data = response.data;
  } else {
    // ç¼–è¯‘å™¨çŸ¥é“ï¼šåªæœ‰ message å’Œ code
    console.error(response.message);
  }
}
```

#### é€šç”¨è¯·æ±‚ç±»å‹

```typescript
// æ”¯æŒä»»ä½•è¯·æ±‚/å“åº”ç»„åˆ
interface ApiRequest<T = any> {
  method: ApiMethod;
  url: string;
  data?: T;
  headers?: Record<string, string>;
}

// ä½¿ç”¨ï¼š
const userRequest: ApiRequest<CreateUserInput> = {
  method: "POST",
  url: "/api/users",
  data: { name: "å¼ ä¸‰", email: "..." }
};

// è‡ªåŠ¨æ¨æ–­å“åº”ç±»å‹
const response = await apiCall<CreateUserInput, UserProfile>(
  userRequest
);
```

---

### ğŸ“Š çŸ¥è¯†ç‚¹å¯¹ç…§è¡¨

| çŸ¥è¯†ç‚¹ | é¡¹ç›®1 | é¡¹ç›®2 | é¡¹ç›®3 | é¡¹ç›®4 | é¡¹ç›®5 | é¡¹ç›®6 |
|--------|------|------|------|------|------|------|
| æ¥å£   | âœ“âœ“âœ“  | âœ“âœ“   | âœ“âœ“   | -    | âœ“    | âœ“âœ“âœ“  |
| ç±»å‹åˆ«å | âœ“âœ“  | âœ“    | âœ“    | âœ“âœ“   | âœ“    | âœ“âœ“   |
| æ³›å‹   | -    | âœ“âœ“âœ“  | âœ“âœ“   | âœ“âœ“   | âœ“âœ“âœ“  | âœ“âœ“âœ“  |
| ç±»ä¸ç»§æ‰¿ | âœ“âœ“âœ“ | âœ“âœ“   | -    | âœ“    | âœ“âœ“   | -    |
| async/await | - | -    | âœ“âœ“âœ“  | -    | -    | âœ“âœ“   |
| è”åˆç±»å‹ | -  | -    | -    | -    | -    | âœ“âœ“âœ“  |

---

### ğŸš€ å­¦ä¹ è·¯å¾„å»ºè®®

#### ç¬¬ä¸€éï¼šç†è§£é¡¹ç›®
1. è¿è¡Œ `ç»¼åˆç»ƒä¹ .ts` æŸ¥çœ‹è¾“å‡º
2. é€ä¸ªé˜…è¯»æ¯ä¸ªé¡¹ç›®çš„ä»£ç 
3. å°è¯•ä¿®æ”¹ä»£ç ï¼Œè§‚å¯Ÿ TypeScript çš„ç±»å‹æ£€æŸ¥

#### ç¬¬äºŒéï¼šæ·±åŒ–ç†è§£
1. ç»™æ¯ä¸ªé¡¹ç›®æ·»åŠ æ–°åŠŸèƒ½
   - ç”¨æˆ·ç®¡ç†ï¼šæ·»åŠ è§’è‰²æƒé™æ£€æŸ¥
   - è´­ç‰©è½¦ï¼šæ·»åŠ æŠ˜æ‰£è®¡ç®—
   - å¼‚æ­¥æ•°æ®ï¼šæ·»åŠ ç¼“å­˜æœºåˆ¶
2. åˆ›å»ºæ›´å¤šäº‹ä»¶ç±»å‹
3. è®¾è®¡è‡ªå·±çš„ Pipeline è½¬æ¢

#### ç¬¬ä¸‰éï¼šé¡¹ç›®åº”ç”¨
1. åœ¨ Koa é¡¹ç›®ä¸­åº”ç”¨è¿™äº›æ¨¡å¼
2. ä¸º API ç«¯ç‚¹è®¾è®¡å®Œæ•´çš„ç±»å‹
3. ä½¿ç”¨äº‹ä»¶ç³»ç»Ÿå¤„ç†ä¸šåŠ¡é€»è¾‘

---

### ğŸ’¡ å¸¸è§é—®é¢˜

**Q: ä¸ºä»€ä¹ˆè¦ç”¨ Pipeline è€Œä¸æ˜¯ç›´æ¥èµ‹å€¼ï¼Ÿ**

```typescript
// âŒ å®¹æ˜“å‡ºé”™
let result: string = "hello";
result = toUpperCase(result);
result = addPrefix(result);
// å¿˜è®°äº†ä¸€ä¸ªè½¬æ¢æ­¥éª¤...

// âœ… æ¸…æ™°çš„æµç¨‹
const result = new Pipeline("hello")
  .pipe(toUpperCase)
  .pipe(addPrefix)
  .get();
```

**Q: FetchResult å’Œ Promise.reject æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ**

```typescript
// Promise.reject - å¿…é¡»ç”¨ try-catch
try {
  const user = await fetchUserData(1); // å¯èƒ½ throw
} catch (error) {
  // é”™è¯¯å¤„ç†
}

// FetchResult - å¯ä»¥ç”¨é€»è¾‘åˆ†æ”¯
const result = await fetchUserData(1);
if (result.success) {
  console.log(result.data); // ç±»å‹å®‰å…¨
}
```

**Q: ä¸ºä»€ä¹ˆ CartItem è¦åŒ…å« subtotalï¼Ÿ**

```typescript
// åŸå› ï¼šç¼“å­˜è®¡ç®—ç»“æœ
interface CartItem<T extends Product> {
  product: T;
  quantity: number;
  subtotal: number; // è€Œä¸æ˜¯æ¯æ¬¡éƒ½è®¡ç®— quantity * product.price
}

// å¥½å¤„ï¼š
// 1. æ€§èƒ½ï¼šä¸éœ€è¦é‡å¤è®¡ç®—
// 2. ä¸€è‡´æ€§ï¼šé¿å…ä»·æ ¼å˜åŒ–å¼•èµ·çš„ä¸ä¸€è‡´
// 3. å‡†ç¡®æ€§ï¼šè®°å½•è´­ä¹°æ—¶çš„å®é™…ä»·æ ¼
```

---

### ğŸ“ ä¸‹ä¸€é˜¶æ®µå‡†å¤‡

è¿™ 6 ä¸ªé¡¹ç›®çš„è®¾è®¡æ¨¡å¼å’Œç±»å‹å®šä¹‰åœ¨ Koa å¼€å‘ä¸­ä¼šè¢«å¤§é‡ä½¿ç”¨ï¼š

- **ç”¨æˆ·ç®¡ç†ç³»ç»Ÿ** â†’ Koa çš„ä¸­é—´ä»¶å’Œè·¯ç”±å¤„ç†
- **è´­ç‰©è½¦ç³»ç»Ÿ** â†’ æ•°æ®åº“æ¨¡å‹å’Œ ORM
- **å¼‚æ­¥æ•°æ®å¤„ç†** â†’ Koa çš„æ ¸å¿ƒè¿è¡Œæœºåˆ¶
- **Pipeline** â†’ ä¸­é—´ä»¶é“¾
- **äº‹ä»¶ç³»ç»Ÿ** â†’ æ¡†æ¶å†…çš„äº‹ä»¶é©±åŠ¨
- **API ç±»å‹** â†’ å®Œæ•´çš„ RESTful API å®šä¹‰

å‡†å¤‡å¥½è¿›å…¥ç¬¬ä¸‰é˜¶æ®µäº†å—ï¼Ÿâœ¨

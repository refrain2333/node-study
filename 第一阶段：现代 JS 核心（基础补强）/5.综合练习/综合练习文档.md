# 综合练习文档

## 概述
综合练习整合了第一阶段学习的知识点，包括变量作用域、箭头函数、异步编程和数组方法。通过实际项目案例，展示如何在真实场景中应用这些概念。

## 项目案例

### 项目1：学生成绩管理系统

#### 数据结构
```javascript
const students = [
    {
        id: 1,
        name: "张三",
        age: 18,
        grades: { math: 85, english: 92, science: 78 }
    }
    // ... 更多学生
];
```

#### 核心功能

**1. 计算平均分**
```javascript
const studentsWithAverage = students.map(student => {
    const grades = Object.values(student.grades);
    const average = grades.reduce((sum, grade) => sum + grade, 0) / grades.length;
    return { ...student, average: Math.round(average * 100) / 100 };
});
```

**2. 筛选优秀学生**
```javascript
const excellentMathStudents = studentsWithAverage.filter(s => s.grades.math > 90);
```

**3. 排序**
```javascript
const sortedByAverage = studentsWithAverage.sort((a, b) => b.average - a.average);
```

**4. 计算科目平均分**
```javascript
const subjectAverages = subjects.map(subject => {
    const total = students.reduce((sum, student) => sum + student.grades[subject], 0);
    return { subject, average: total / students.length };
});
```

### 项目2：电商库存管理系统

#### 数据结构
```javascript
const products = [
    {
        id: 1,
        name: "iPhone 15",
        category: "手机",
        price: 7999,
        stock: 50,
        sales: 120
    }
    // ... 更多产品
];
```

#### 核心功能

**1. 计算库存总价值**
```javascript
const totalValue = products.reduce((total, product) =>
    total + (product.price * product.stock), 0
);
```

**2. 按类别分组统计**
```javascript
const categoryStats = products.reduce((acc, product) => {
    if (!acc[product.category]) {
        acc[product.category] = { count: 0, totalStock: 0, totalValue: 0 };
    }
    acc[product.category].count++;
    acc[product.category].totalStock += product.stock;
    acc[product.category].totalValue += product.price * product.stock;
    return acc;
}, {});
```

**3. 销售占比分析**
```javascript
const totalSales = products.reduce((sum, p) => sum + p.sales, 0);
const salesByCategory = products.reduce((acc, product) => {
    acc[product.category] = (acc[product.category] || 0) + product.sales;
    return acc;
}, {});

const salesPercentage = Object.keys(salesByCategory).map(category => ({
    category,
    sales: salesByCategory[category],
    percentage: Math.round((salesByCategory[category] / totalSales) * 100)
}));
```

### 项目3：异步数据处理系统

#### 异步函数示例
```javascript
function fetchUserData(userId) {
    return new Promise((resolve) => {
        setTimeout(() => {
            resolve({
                id: userId,
                name: `用户${userId}`,
                email: `user${userId}@example.com`
            });
        }, 200);
    });
}

async function batchFetchUsers(userIds) {
    try {
        const users = await Promise.all(userIds.map(id => fetchUserData(id)));
        return users;
    } catch (error) {
        console.error("获取用户失败:", error);
        return [];
    }
}
```

#### 综合数据处理
```javascript
async function analyzeUsers(userIds) {
    const users = await batchFetchUsers(userIds);
    const userAnalyses = await Promise.all(
        users.map(async (user) => {
            const orders = await getUserOrdersWithProcessing(user.id);
            const totalSpent = orders.reduce((sum, order) => sum + order.amount, 0);
            return {
                user: user.name,
                totalOrders: orders.length,
                totalSpent,
                avgOrder: orders.length > 0 ? totalSpent / orders.length : 0
            };
        })
    );
    return userAnalyses;
}
```

### 项目4：数据验证和转换管道

#### 数据处理管道
```javascript
function processDataPipeline(data) {
    return data
        // 1. 验证数据
        .map(item => {
            const errors = [];
            const isValid = Object.keys(validators).every(key => {
                const isValidField = validators[key](item[key]);
                if (!isValidField) errors.push(`${key} 字段无效`);
                return isValidField;
            });
            return { ...item, isValid, errors };
        })
        // 2. 过滤有效数据
        .filter(item => item.isValid)
        // 3. 转换数据
        .map(item => {
            const transformed = {};
            Object.keys(transformers).forEach(key => {
                transformed[key] = transformers[key](item[key]);
            });
            return transformed;
        })
        // 4. 添加额外字段
        .map(item => ({
            ...item,
            id: Math.floor(Math.random() * 10000),
            createdAt: new Date().toISOString(),
            ageGroup: item.age < 30 ? "青年" : "中年"
        }));
}
```

### 项目5：电商数据分析

#### 用户生命周期价值 (LTV)
```javascript
const userLTV = ecommerceData.users.map(user => {
    const userOrders = ecommerceData.orders.filter(order => order.userId === user.id);
    const totalSpent = userOrders.reduce((sum, order) => {
        const product = ecommerceData.products.find(p => p.id === order.productId);
        return sum + (product.price * order.quantity);
    }, 0);

    return {
        ...user,
        totalOrders: userOrders.length,
        totalSpent,
        avgOrderValue: userOrders.length > 0 ? totalSpent / userOrders.length : 0
    };
});
```

#### 月度销售统计
```javascript
const monthlySales = ecommerceData.orders.reduce((acc, order) => {
    const month = order.orderDate.substring(0, 7);
    const product = ecommerceData.products.find(p => p.id === order.productId);
    const revenue = product.price * order.quantity;

    if (!acc[month]) {
        acc[month] = {
            month,
            totalOrders: 0,
            totalRevenue: 0,
            totalUnits: 0,
            uniqueCustomers: new Set()
        };
    }

    acc[month].totalOrders++;
    acc[month].totalRevenue += revenue;
    acc[month].totalUnits += order.quantity;
    acc[month].uniqueCustomers.add(order.userId);

    return acc;
}, {});
```

## 学习要点总结

### 1. 变量与作用域
- ✅ 掌握 `let/const` 与 `var` 的区别
- ✅ 理解块级作用域
- ✅ 使用闭包和 IIFE

### 2. 箭头函数
- ✅ 掌握箭头函数语法
- ✅ 理解 `this` 绑定差异
- ✅ 在数组方法中的应用

### 3. 异步编程
- ✅ Promise 的 `then/catch` 机制
- ✅ `async/await` 语法
- ✅ 异步错误处理

### 4. 数组方法
- ✅ `map`, `filter`, `find`, `reduce` 的使用
- ✅ 函数式编程思想
- ✅ 链式调用技巧

## 学习建议

1. **每日练习**：每天练习 2-3 个示例
2. **代码修改**：尝试修改代码观察不同效果
3. **思维转换**：将 Python 思维转换为 JavaScript 思维
4. **调试技巧**：多使用 `console.log` 调试
5. **理解返回值**：理解每个方法的返回值和副作用

## 下一步
完成第一阶段后，进入第二阶段 TypeScript 学习！

## 运行说明
```bash
node 综合练习.js
```

输出将展示各个项目的执行结果，包括数据处理、异步操作和综合分析。
# 变量与作用域 - 快速参考

## 声明方式对比

| 声明方式 | 作用域 | 重复声明 | 变量提升 | 暂时性死区 | 推荐使用场景 |
|---------|--------|----------|----------|------------|-------------|
| `var` | 函数作用域 | ✅ | ✅ | ❌ | 遗留代码兼容 |
| `let` | 块级作用域 | ❌ | ❌ | ✅ | 需要重新赋值的变量 |
| `const` | 块级作用域 | ❌ | ❌ | ✅ | 常量、对象引用 |

## 代码示例

### 基础用法
```javascript
// ✅ 推荐
const PI = 3.14159;
const config = { theme: 'dark' };
let counter = 0;

// ❌ 避免
var globalVar = "全局变量";
```

### 循环中的正确用法
```javascript
// ❌ 问题代码
for (var i = 0; i < 3; i++) {
    setTimeout(() => console.log(i), 100); // 输出: 3, 3, 3
}

// ✅ 正确代码
for (let i = 0; i < 3; i++) {
    setTimeout(() => console.log(i), 100); // 输出: 0, 1, 2
}
```

### 模块模式
```javascript
const Module = (function() {
    let privateVar = "私有";
    
    return {
        getPrivate() {
            return privateVar;
        }
    };
})();
```

### 安全计数器
```javascript
function createCounter() {
    let count = 0;
    return {
        increment: () => ++count,
        getCount: () => count
    };
}
```

## 常见陷阱

### 1. 暂时性死区
```javascript
console.log(x); // ReferenceError
let x = 1;
```

### 2. 全局污染
```javascript
function bad() {
    accidentalGlobal = "污染"; // 没有声明
}
```

### 3. 循环闭包
```javascript
// ❌
const funcs = [];
for (var i = 0; i < 3; i++) {
    funcs[i] = () => i;
}
console.log(funcs[0]()); // 3

// ✅
const funcs = [];
for (let i = 0; i < 3; i++) {
    funcs[i] = () => i;
}
console.log(funcs[0]()); // 0
```

## 最佳实践

### ✅ 推荐做法
```javascript
// 1. 优先使用 const
const API_URL = "https://api.example.com";

// 2. 使用块级作用域
{
    const blockVar = "块级";
}

// 3. 避免全局变量
const app = (function() {
    let privateData = [];
    return { /* 公共接口 */ };
})();

// 4. 及时清理引用
function process() {
    let largeData = new Array(1000000);
    const result = largeData.slice(0, 100);
    largeData = null; // 清理
    return result;
}
```

### ❌ 避免做法
```javascript
// 1. 不声明变量
function bad() {
    globalVar = "全局"; // 意外创建全局变量
}

// 2. 在循环中使用 var
for (var i = 0; i < 10; i++) {
    // i 在循环外也可访问
}

// 3. 在声明前使用变量
console.log(x); // ReferenceError
let x = 1;
```

## 与 Python 对比

| JavaScript | Python | 说明 |
|-----------|--------|------|
| `let x = 1` | `x = 1` | 变量声明 |
| `const x = 1` | `X = 1` | 常量约定 |
| `var x = 1` | `global x` | 全局变量 |
| 块级作用域 | 函数作用域 | 作用域差异 |
| 暂时性死区 | 无 | 声明前访问 |

## 记忆口诀

> **"const 优先，let 次之，var 避免"**  
> **"块级作用域，避免污染"**  
> **"声明前访问，暂时性死区"**  
> **"闭包有用，但要小心内存"**

## 调试技巧

### 检查变量存在性
```javascript
// 检查变量是否定义
if (typeof variable !== 'undefined') {
    console.log('变量存在');
}

// 检查属性是否存在
if ('property' in object) {
    console.log('属性存在');
}
```

### 作用域调试
```javascript
function debugScope() {
    let local = "局部变量";
    
    console.log("函数内:", local);
    
    {
        let block = "块级变量";
        console.log("块内:", local, block);
    }
    
    // console.log("块外:", block); // ReferenceError
}
```

## 总结要点

1. **优先使用 `const`** - 防止意外修改
2. **理解块级作用域** - 避免变量冲突
3. **避免全局污染** - 使用模块模式
4. **注意暂时性死区** - 不在声明前使用
5. **及时清理引用** - 防止内存泄漏
6. **善用闭包** - 创建私有状态

掌握这些概念，你就能写出更安全、更清晰的 JavaScript 代码！
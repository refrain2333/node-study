# 箭头函数基础文档

## 概述
箭头函数（Arrow Functions）是 ES6 引入的函数语法糖，提供更简洁的函数定义方式。主要特点是简化的语法和词法作用域的 `this` 绑定。

## 基本语法

### 传统函数 vs 箭头函数
```javascript
// 传统函数声明
function traditionalFunction(x, y) {
    return x + y;
}

// 箭头函数 - 多行函数体
const arrowFunction1 = (x, y) => {
    return x + y;
};

// 箭头函数 - 单行表达式（隐式返回）
const arrowFunction2 = (x, y) => x + y;

// 箭头函数 - 单个参数（可省略括号）
const square = x => x * x;

// 箭头函数 - 无参数
const getRandom = () => Math.random();
```

### 语法规则
- **参数**：无参数用 `()`，单参数可省略 `()`，多参数用 `()`。
- **函数体**：单行表达式自动返回，多行用 `{}` 并显式 `return`。
- **返回值**：单行自动返回，多行需 `return`。

## this 绑定差异

### 传统函数
- `this` 指向调用者（动态绑定）。
- 在回调中可能丢失上下文。

### 箭头函数
- `this` 继承外层作用域（词法绑定）。
- 不适合作为对象方法（`this` 指向错误）。

```javascript
const obj = {
    name: "对象",
    
    traditionalMethod() {
        setTimeout(function() {
            console.log("传统函数内部的 this:", this.name); // undefined
        }, 100);
    },
    
    arrowMethod() {
        setTimeout(() => {
            console.log("箭头函数内部的 this:", this.name); // "对象"
        }, 200);
    }
};
```

## 应用场景

### 数组方法
```javascript
const numbers = [1, 2, 3, 4, 5];

const doubled = numbers.map(n => n * 2);        // [2, 4, 6, 8, 10]
const evens = numbers.filter(n => n % 2 === 0); // [2, 4]
const found = numbers.find(n => n > 3);         // 4
const sum = numbers.reduce((acc, n) => acc + n, 0); // 15
```

### Node.js 中间件
```javascript
const createMiddleware = (name) => async (ctx, next) => {
    console.log(`${name} 中间件开始`);
    const startTime = Date.now();
    await next();
    const endTime = Date.now();
    console.log(`${name} 中间件结束，耗时: ${endTime - startTime}ms`);
};
```

### 事件处理
```javascript
element.addEventListener('click', (event) => {
    console.log("箭头函数事件处理器:", event.type);
});
```

### Promise 链
```javascript
Promise.resolve(1)
    .then(x => x * 2)
    .then(x => x + 1)
    .then(result => console.log("结果:", result)); // 3
```

## 注意事项和限制

### 不能作为构造函数
```javascript
const ArrowConstructor = (name) => { this.name = name; };
// new ArrowConstructor("test"); // 错误：不是构造函数
```

### 没有 arguments 对象
```javascript
const arrowFunction = () => {
    // console.log(arguments); // 错误：arguments 未定义
};
```

### 不能使用 yield（生成器函数）
```javascript
// const generatorArrow = () => { yield 1; }; // 语法错误
```

### 对象方法中的 this 问题
```javascript
const calculator = {
    value: 0,
    
    // 错误：箭头函数的 this 指向错误
    // add: (x) => this.value += x,
    
    // 正确：使用普通函数
    add(x) {
        this.value += x;
        return this;
    }
};
```

## 练习题

### 练习1：修复 this 绑定问题
```javascript
const user = {
    name: "张三",
    
    greet: function() {
        setTimeout(() => {
            console.log("你好:", this.name); // 使用箭头函数修复
        }, 100);
    }
};
```

### 练习2：数组操作
```javascript
const products = [
    { name: "苹果", price: 5 },
    { name: "香蕉", price: 3 }
];

// 1. 价格大于 3 的产品
const expensive = products.filter(p => p.price > 3);

// 2. 总价
const total = products.reduce((sum, p) => sum + p.price, 0);

// 3. 产品描述
const descriptions = products.map(p => `${p.name} - ¥${p.price}`);
```

### 练习3：HTTP 请求包装器
```javascript
const api = {
    getUsers: () => http.get('/api/users'),
    createUser: (user) => http.post('/api/users', user)
};
```

## 总结
- 箭头函数适合简短函数、回调、数组方法。
- 注意 `this` 绑定差异，避免在对象方法中使用。
- 与传统函数结合使用，根据场景选择合适的方式。